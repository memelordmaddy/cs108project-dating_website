<!DOCTYPE html>
<html lang="en">
    <head>
    </head>
    <body>
        <audio id="audio" style="display: none;" loop>
            <source src="music.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                var audio = document.getElementById("audio");
                
                // Check if playback time is stored in sessionStorage
                var storedTime = sessionStorage.getItem("audioPlaybackTime");
                if (storedTime) {
                    audio.currentTime = parseFloat(storedTime);
                }
                
                // Start or resume audio playback
                audio.play();
                
                // Store current playback time in sessionStorage when navigating away from the page
                window.addEventListener("beforeunload", function() {
                    sessionStorage.setItem("audioPlaybackTime", audio.currentTime);
                });
            });
        </script>
        <div id="match">
            <!-- Match details will be dynamically added here -->
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
    // Get the index parameter from the URL
            const urlParams = new URLSearchParams(window.location.search);
            const index = parseInt(urlParams.get('index'));
            const user = parseInt(urlParams.get('user'));
            console.log(user);
    // Call foundMatch() with the index
            foundMatch(index, user);
            });
            function foundMatch(index, user) {
            //const urlParams = new URLSearchParams(window.location.search);
            //const index = parseInt(urlParams.get('index'));
            if(index != -1)
            {
                
            fetch('student.json')
            .then(response => response.json())
            .then(data => {
            
                if(data[index].Gender == data[user].Gender)
                { 
                    if(data[index].Gender=="Male")
                    {document.body.classList.add('gaymatch');}
                    else
                    {document.body.classList.add('lesbianmatch');}
                }
                else
                {
                    document.body.classList.add('straightmatch');
                }

            const studentDiv = document.createElement('div');
            studentDiv.innerHTML = `
                <h3>${data[index].Name}</h3>
                <p>Age: ${data[index].Age}</p>
                <p>Gender: ${data[index].Gender}</p>
                <p>Interests: ${data[index].Interests.join(', ')}</p>
                <p>Hobbies: ${data[index].Hobbies.join(', ')}</p>
                <p>Matched with: ${data[user].Name}</p>
                <img src="${data[index].Photo}" alt="Student Photo" style="width: 25%; height: auto;"> <br><br>
                <button onclick="mail()">Mail Your Match</button>
            `;
            // Append the created div to appropriate DOM element
            // <p>Matched with: ${data[user].Name}</p>
            document.getElementById('match').appendChild(studentDiv);
        }); }
        else
        {
            const studentDiv = document.createElement('div');
            studentDiv.innerHTML = `
                <h3>No Match found</h3>
            `;
            document.getElementById('match').appendChild(studentDiv);
        }
}
function mail() {
    const urlParams = new URLSearchParams(window.location.search);
    const index = parseInt(urlParams.get('index'));
    const user = parseInt(urlParams.get('user'));

    fetch('student.json')
        .then(response => response.json())
        .then(data => {
            const userInterests = data[user].Interests;
            const userHobbies = data[user].Hobbies;
            const receiverInterests = data[index].Interests;
            const receiverHobbies = data[index].Hobbies;

            // Find the intersection of interests and hobbies
            const sharedInterests = userInterests.filter(interest => receiverInterests.includes(interest));
            const sharedHobbies = userHobbies.filter(hobby => receiverHobbies.includes(hobby));

            // Create custom mail content
            const mailContent = `Dear ${data[index].Name},\n\n` +
                `I noticed that we share some interests like ${sharedInterests.join(', ')} and hobbies such as ${sharedHobbies.join(', ')}, which I find exciting! ` +
                `It would be great to connect and explore these common interests together.\n\n` +
                `Looking forward to getting to know you better!\n\n` +
                `Best regards,\n${data[user].Name}`;

            // Create mailto link
            const mailtoLink = `mailto:${data[index].Email}?subject=Dating Proposal&body=${encodeURIComponent(mailContent)}`;

            // Open default email client with pre-filled message
            window.location.href = mailtoLink;
        });
}

        </script>
    <style>
        body {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    background-size: cover;
    background-repeat: no-repeat;
}

/* Background for same gender match */
body.gaymatch {
    background-image: url('backgroundimages/brokebackmountain.jpg');
}

/* Background for different gender match */
body.straightmatch {
    background-image: url('backgroundimages/pastlives.jpg');
}
body.lesbianmatch {
    background-image: url('backgroundimages/portraitofaladyonfire.jpg');
}
    </style>
    </body>
</html>

